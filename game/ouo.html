<!DOCTYPE html>
<html>
<head>
    <title>game</title>
    <script src="phaser.min.js"></script>
    <style>
        #web{
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #zone{
            display: flex;
            justify-content: center;
            align-items: center; 
            width: 1200px;
            height: 600px;
        }
        #Information{
            background-color: gray;
            width: 200px;
            height: 600px;
            font-size: 20px;
        }        
        #game-container{
            width : 800px;
            height : 600px;
            background-color: black;

        }
    </style>
</head>
<body id="web"><!--基礎物件-->
    <div id="zone">
        <div id="Information"></div>
        <div id="game-container"></div>
        <div id="Information">
            <table width="200" style="color: white;">
                <tr> <td>卡片資訊：</td> </tr>
                <tbody id="image-content"></tbody>
                <tbody id="file-content"></tbody>
            </table>
        </div>
    </div>
</body>
<body>
    <script>

        var platform;
        var graphics;
        var config = {              //物件屬性
            type: Phaser.AUTO,      //自動選擇為最好的渲染方式
            width: 800,             //寬高設定
            height: 600,
            parent: 'game-container',
            physics: {              //加入物理模塊
                default: 'arcade',
                arcade: {
                    gravity: { y: 300 },
                    debug: false
                }
            },
            scene: {                
                preload: preload,   //加載資料
                create: create,     //創建畫面
                update: update,     //刷新畫面
            }
        };

        var Magic_poker={
            defaultColor:0xffffff,
            hoverColor : 0x00ffff,
            Player_Attributes:0xFFFF00,
            enemy_Attributes:0xFF0000,
            card_form:{
                Attributes:0,   //卡片屬性 0土、1水、2火、3風
                cardlevel:6,    //卡片等級 1~13
                cardname:'water6',
                cardtextline:6, //卡片文字列
            },
            
            self_role:'dust_face2',
            other_role:'fire_face2',
            portrait_name:['dust_face','water_face','fire_face','wind_face'],
            card_name:['dust','water','fire','wind'],
            drawstrokeRoundedRect(graphics, x, y, width, height, radius, color){
                graphics.lineStyle(2, color);
                graphics.strokeRoundedRect(x, y, width, height, radius);
            },
            drawzone(scene){                            //繪製卡牌放置區
                var rectGraphics = scene.add.graphics();
                rectGraphics.fillStyle(0x444444, 1);
                rectGraphics.fillRect(0, 0, 800, 600);
                rectGraphics.fillStyle(0xDDDDDD, 1);
                rectGraphics.fillRect(0, 0, 800, 100);

                var graphics = scene.add.graphics();
                var defaultColor = this.defaultColor;
                var hoverColor = this.hoverColor;

                for (var row = 0; row < 2; row++) for (var col = 0; col < 5; col++) {
                    var x = 40 + col * 100;
                    var y = 130 + row * 156;
                    var width = 64;
                    var height = 96;
                    var radius = 20;
                    this.drawstrokeRoundedRect(graphics, x, y, width, height, radius, this.defaultColor);
                    (function (graphics, x, y, width, height, radius) {
                        graphics.setInteractive(new Phaser.Geom.Rectangle(x, y, width, height), Phaser.Geom.Rectangle.Contains);
                        graphics.on('pointerover', function () {
                            Magic_poker.drawstrokeRoundedRect(graphics, x, y, width, height, radius, hoverColor);
                        }, this);
                        graphics.on('pointerout', function () {
                            Magic_poker.drawstrokeRoundedRect(graphics, x, y, width, height, radius, defaultColor);
                        }, this);
                    })(graphics, x, y, width, height, radius);
                }
                var fwidth = 124;
                var fheight = 186;
                var fradius = 0;
                var fx=650;
                var fy=130;
                this.drawstrokeRoundedRect(graphics, fx, fy, fwidth, fheight, fradius, this.defaultColor);
                var card = scene.add.image( fx,fy , this.card_form );
                card.displayWidth =124;
                card.displayHeight=186;
                card.setOrigin(0, 0);
                this.drawstrokeRoundedRect(graphics, fx, fy + 200, fwidth, fheight/2, 20, this.defaultColor);

            },
            createPlayerUI(scene, isPlayer) {
                var x = 60;
                var y = 50;
                var radius = 50;

                // 头像图片
                var avatar = scene.add.image(isPlayer ? 0 : config.width - x - radius , -20 , isPlayer ? this.self_role : this.other_role );
                avatar.displayWidth =120;
                avatar.displayHeight=120;
                avatar.setOrigin(0, 0);
                
                var graphics = scene.add.graphics();
                graphics.beginPath();
                graphics.moveTo(x + radius, y);
                graphics.arc(x, y, radius, 0, Phaser.Math.PI2 / 4, false);
                graphics.lineTo(config.width - x, y+radius);
                graphics.arc(config.width - x, y, radius, Phaser.Math.PI2 / 4, Phaser.Math.PI2 / 2, false);
                graphics.lineTo(config.width - x - radius, 0);
                graphics.lineTo(x+radius, 0);
                graphics.lineTo(x+radius, y);
                graphics.closePath();
                graphics.fillStyle(0xffffff,1)
                graphics.fillPath();
            },
            Adjustment(){
                this.card_form.cardname = `${this.card_name[this.card_form.Attributes]}${this.card_form.cardlevel}`;
                this.card_form.cardtextline = this.card_form.cardlevel + this.card_form.Attributes*13;
                
            },
        }

        var game = new Phaser.Game(config);

        function preload(){
            for(let i=0;i<4;i++) for(let j=1;j<=3;j++)
                this.load.image(`${Magic_poker.portrait_name[i]}${j}`,`portrait/${Magic_poker.portrait_name[i]}${j}.png`)
            for(let i=0;i<4;i++) for(let j=1;j<=13;j++)
                this.load.image(`${Magic_poker.card_name[i]}${j}`,`card/${Magic_poker.card_name[i]}-${j}.png`)
            this.load.image(`water6`,`card/water-6.png`)

        }

        function create(){

            Magic_poker.drawzone(this);
            Magic_poker.createPlayerUI(this, true);     // 玩家
            Magic_poker.createPlayerUI(this, false);    // 敌人

            var playerAvatarImage = this.textures.get(Magic_poker.card_form.cardname); // 替换 'playerAvatar' 为您加载的图像的键
            var img = document.createElement('img');
            img.src = playerAvatarImage.url;
            img.width = 128;
            img.height = 192;
            var imageContent = document.getElementById('image-content');
            imageContent.appendChild(img);
            loadTextFile('cardform.txt');

            console.log(Magic_poker.card_form.cardname);
        }
        
        function update(){
            Magic_poker.Adjustment();
        }
        

        function loadTextFile(filename) {
            fetch(filename)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Network response was not ok: ${response.statusText}`);
                }
                return response.text();
            })
            .then(text => {
                const lineNumberToShow = Magic_poker.card_form.cardtextline; // 想要显示的行号
                const lines = text.split('\n');

                if (lineNumberToShow >= 1 && lineNumberToShow <= lines.length) {
                    const selectedLine = lines[lineNumberToShow - 1];
                    document.getElementById('file-content').textContent = selectedLine;
                } else {
                    document.getElementById('file-content').textContent = '选择的行号无效';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('file-content').textContent = '无法加载文件';
            });
        }
    </script>
</body>
</html>
